# ç‰ˆæœ¬æ§åˆ¶å’Œå¼ºåˆ¶æ›´æ–°æŒ‡å—

## ğŸ¯ ä½ çš„éœ€æ±‚ï¼šæ¨¡å¼3 - é˜»æ­¢æ—§ç‰ˆæœ¬

**ç›®æ ‡ï¼š**
- âœ… å‘å¸ƒæ–°ç‰ˆæœ¬åï¼Œè€ç‰ˆæœ¬ç«‹å³å¤±æ•ˆ
- âœ… ç”¨æˆ·å¿…é¡»æ›´æ–°æ‰èƒ½ä½¿ç”¨
- âœ… ç¡®ä¿æ‰€æœ‰ç”¨æˆ·éƒ½åœ¨æœ€æ–°ç‰ˆæœ¬

---

## ğŸ“‹ Supabase é…ç½®ç­–ç•¥

### é¦–æ¬¡å‘å¸ƒï¼ˆç‰ˆæœ¬ 1.0.0ï¼‰

```sql
-- æ’å…¥åˆå§‹ç‰ˆæœ¬ä¿¡æ¯ï¼ˆä¸è§¦å‘æ›´æ–°ï¼‰
INSERT INTO app_versions (
  version, 
  min_version, 
  force_update, 
  update_package_url,
  update_log,
  file_size,
  is_active
) VALUES (
  '1.0.0',
  '1.0.0',           -- æœ€ä½ç‰ˆæœ¬å°±æ˜¯å½“å‰ç‰ˆæœ¬
  false,             -- ä¸è§¦å‘æ›´æ–°
  'https://ä½ çš„é¡¹ç›®.supabase.co/storage/v1/object/public/app-updates/update-1.0.0.zip',
  'åˆå§‹ç‰ˆæœ¬',
  0,
  false              -- ğŸ”‘ å…³é”®ï¼šè®¾ä¸º falseï¼Œä¸æ¿€æ´»æ­¤ç‰ˆæœ¬
);
```

**è¯´æ˜ï¼š**
- `is_active = false` - ä¸ä¼šè¢«æ£€æµ‹åˆ°
- ç”¨æˆ·ä½¿ç”¨ 1.0.0 ç‰ˆæœ¬æ—¶ä¸ä¼šå¼¹å‡ºæ›´æ–°æç¤º

---

## ğŸš€ å‘å¸ƒæ–°ç‰ˆæœ¬ï¼ˆ1.0.1ï¼‰

### æ­¥éª¤1ï¼šæ„å»ºæ–°ç‰ˆæœ¬

```powershell
# 1. ä¿®æ”¹ pubspec.yaml
version: 1.0.1+1

# 2. æ„å»º
flutter clean
flutter build windows --release

# 3. åˆ›å»ºæ›´æ–°åŒ…
cd build\windows\x64\runner\Release
# å‹ç¼©éœ€è¦çš„æ–‡ä»¶ï¼š
# - xinghe_new.exe
# - flutter_windows.dll
# - data\app.so
# ä¿å­˜ä¸º: update-1.0.1.zip
```

### æ­¥éª¤2ï¼šä¸Šä¼ åˆ° Supabase

```
1. Supabase Dashboard â†’ Storage â†’ app-updates
2. Upload file: update-1.0.1.zip
3. å¤åˆ¶æ–‡ä»¶ URL
```

### æ­¥éª¤3ï¼šæ’å…¥æ–°ç‰ˆæœ¬ï¼ˆè®©è€ç‰ˆæœ¬å¤±æ•ˆï¼‰

```sql
-- æ’å…¥æ–°ç‰ˆæœ¬ 1.0.1
INSERT INTO app_versions (
  version, 
  min_version,        -- ğŸ”‘ å…³é”®é…ç½®
  force_update,       -- ğŸ”‘ å…³é”®é…ç½®
  update_package_url,
  update_log,
  file_size,
  is_active
) VALUES (
  '1.0.1',
  '1.0.1',           -- ğŸ”‘ è®¾ç½®ä¸ºå½“å‰ç‰ˆæœ¬ï¼Œè®©æ‰€æœ‰æ—§ç‰ˆæœ¬å¤±æ•ˆ
  true,              -- ğŸ”‘ å¼ºåˆ¶æ›´æ–°
  'https://ä½ çš„é¡¹ç›®.supabase.co/storage/v1/object/public/app-updates/update-1.0.1.zip',
  'æ–°å¢ä¼šå‘˜ç³»ç»Ÿï¼Œè€ç‰ˆæœ¬å·²åœç”¨',
  5242880,
  true               -- ğŸ”‘ æ¿€æ´»æ­¤ç‰ˆæœ¬
);
```

**å…³é”®é…ç½®ï¼š**
- `min_version = '1.0.1'` - æœ€ä½æ”¯æŒç‰ˆæœ¬å°±æ˜¯æœ€æ–°ç‰ˆæœ¬
- `force_update = true` - å¼ºåˆ¶æ›´æ–°
- `is_active = true` - æ¿€æ´»æ£€æµ‹

---

## ğŸ“± ç”¨æˆ·ä½“éªŒ

### åœºæ™¯ï¼šç”¨æˆ·ä½¿ç”¨ç‰ˆæœ¬ 1.0.0

**å¯åŠ¨åº”ç”¨ï¼š**
```
åº”ç”¨å¯åŠ¨
    â†“
æ£€æµ‹ç‰ˆæœ¬ï¼šå½“å‰ 1.0.0 < æœ€ä½ 1.0.1
    â†“
ğŸš« ç‰ˆæœ¬è¿‡ä½ï¼
    â†“
å¼¹å‡ºå¯¹è¯æ¡†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ ç‰ˆæœ¬è¿‡ä½ï¼Œå¿…é¡»æ›´æ–°            â”‚
â”‚                                 â”‚
â”‚  å½“å‰ç‰ˆæœ¬ï¼š1.0.0                 â”‚
â”‚  æœ€æ–°ç‰ˆæœ¬ï¼š1.0.1                 â”‚
â”‚                                 â”‚
â”‚  æ›´æ–°å†…å®¹ï¼š                      â”‚
â”‚  æ–°å¢ä¼šå‘˜ç³»ç»Ÿï¼Œè€ç‰ˆæœ¬å·²åœç”¨       â”‚
â”‚                                 â”‚
â”‚        [ç«‹å³æ›´æ–°]                â”‚  â† å”¯ä¸€é€‰é¡¹
â”‚                                 â”‚
â”‚  âš ï¸ ä¸æ›´æ–°æ— æ³•ä½¿ç”¨è½¯ä»¶           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç”¨æˆ·ç‚¹å‡»"ç«‹å³æ›´æ–°"ï¼š**
```
ä¸‹è½½æ›´æ–°åŒ…ï¼ˆ5MBï¼Œæ˜¾ç¤ºè¿›åº¦ï¼‰
    â†“
è‡ªåŠ¨è§£å‹
    â†“
è‡ªåŠ¨æ›¿æ¢æ–‡ä»¶
    â†“
è‡ªåŠ¨é‡å¯åº”ç”¨
    â†“
âœ… ç°åœ¨æ˜¯ç‰ˆæœ¬ 1.0.1ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨
```

---

## ğŸ”„ æ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬çš„å›ºå®šæµç¨‹

### ğŸ“ æ“ä½œæ¸…å•

```sql
-- 1. æ’å…¥æ–°ç‰ˆæœ¬ä¿¡æ¯
INSERT INTO app_versions (
  version, 
  min_version,        -- âš ï¸ æ°¸è¿œè®¾ç½®ä¸ºå½“å‰ç‰ˆæœ¬å·
  force_update,       -- âš ï¸ æ°¸è¿œè®¾ç½®ä¸º true
  update_package_url,
  update_log,
  file_size,
  is_active
) VALUES (
  '1.0.X',           -- æ–°ç‰ˆæœ¬å·
  '1.0.X',           -- ğŸ”‘ å’Œæ–°ç‰ˆæœ¬å·ç›¸åŒï¼Œè®©æ‰€æœ‰æ—§ç‰ˆæœ¬å¤±æ•ˆ
  true,              -- ğŸ”‘ å¼ºåˆ¶æ›´æ–°
  'https://xxx.supabase.co/storage/v1/object/public/app-updates/update-1.0.X.zip',
  'æ›´æ–°å†…å®¹...',
  æ–‡ä»¶å¤§å°,
  true               -- ğŸ”‘ æ¿€æ´»
);
```

**å…³é”®åŸåˆ™ï¼š**
- `version` å’Œ `min_version` **è®¾ç½®ä¸ºç›¸åŒå€¼**
- è¿™æ ·æ‰€æœ‰ä½äºæ­¤ç‰ˆæœ¬çš„ç”¨æˆ·éƒ½ä¼šè¢«é˜»æ­¢ä½¿ç”¨

---

## ğŸ“Š ç‰ˆæœ¬æ¼”è¿›ç¤ºä¾‹

### æ—¶é—´çº¿ï¼š

**Day 1ï¼šå‘å¸ƒ 1.0.0**
```sql
version = '1.0.0'
min_version = '1.0.0'
is_active = false      -- ä¸æ¿€æ´»ï¼Œå› ä¸ºæ˜¯å½“å‰ç‰ˆæœ¬
```

**Day 10ï¼šå‘å¸ƒ 1.0.1**
```sql
version = '1.0.1'
min_version = '1.0.1'  -- ğŸ”‘ 1.0.0 ç«‹å³å¤±æ•ˆ
is_active = true
```
**ç»“æœï¼š** æ‰€æœ‰ 1.0.0 ç”¨æˆ·å¿…é¡»æ›´æ–°

---

**Day 20ï¼šå‘å¸ƒ 1.0.2**
```sql
version = '1.0.2'
min_version = '1.0.2'  -- ğŸ”‘ 1.0.0 å’Œ 1.0.1 éƒ½å¤±æ•ˆ
is_active = true
```
**ç»“æœï¼š** æ‰€æœ‰ 1.0.0 å’Œ 1.0.1 ç”¨æˆ·å¿…é¡»æ›´æ–°

---

## âš¡ å¿«é€Ÿå‘å¸ƒæµç¨‹ï¼ˆå¤åˆ¶ç²˜è´´å³å¯ï¼‰

### æ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶ï¼š

```powershell
# === ç¬¬1æ­¥ï¼šä¿®æ”¹ç‰ˆæœ¬å· ===
# æ‰“å¼€ pubspec.yaml
# ä¿®æ”¹: version: 1.0.X+X

# === ç¬¬2æ­¥ï¼šæ„å»º ===
flutter clean
flutter build windows --release

# === ç¬¬3æ­¥ï¼šåˆ›å»ºæ›´æ–°åŒ… ===
cd build\windows\x64\runner\Release
# å‹ç¼©: xinghe_new.exe, flutter_windows.dll, data
# ä¿å­˜ä¸º: update-1.0.X.zip

# === ç¬¬4æ­¥ï¼šä¸Šä¼ åˆ° Supabase Storage ===
# Dashboard â†’ Storage â†’ app-updates â†’ Upload

# === ç¬¬5æ­¥ï¼šæ’å…¥ç‰ˆæœ¬ä¿¡æ¯ ===
# å¤åˆ¶ä¸‹é¢çš„ SQLï¼Œä¿®æ”¹ç‰ˆæœ¬å·å’Œ URL
```

```sql
INSERT INTO app_versions (
  version, 
  min_version, 
  force_update, 
  update_package_url,
  update_log,
  file_size,
  is_active
) VALUES (
  '1.0.X',           -- âš ï¸ æ”¹æˆæ–°ç‰ˆæœ¬å·
  '1.0.X',           -- âš ï¸ æ”¹æˆæ–°ç‰ˆæœ¬å·ï¼ˆä¸ä¸Šé¢ç›¸åŒï¼‰
  true,
  'https://tnmbprizergdjrirehyi.supabase.co/storage/v1/object/public/app-updates/update-1.0.X.zip',  -- âš ï¸ æ”¹æˆæ–°æ–‡ä»¶ URL
  'æ›´æ–°å†…å®¹ï¼š\n- æ–°å¢XXX\n- ä¿®å¤YYY',  -- âš ï¸ æ”¹æˆå®é™…æ›´æ–°å†…å®¹
  5242880,           -- âš ï¸ æ”¹æˆå®é™…æ–‡ä»¶å¤§å°
  true
);
```

---

## â±ï¸ æ›´æ–°ç”Ÿæ•ˆæ—¶é—´

**ç«‹å³ç”Ÿæ•ˆï¼**

```
ä½ åœ¨ Supabase æ’å…¥æ–°ç‰ˆæœ¬
    â†“ ï¼ˆå‡ ç§’å†…ï¼‰
ç”¨æˆ·ä¸‹æ¬¡å¯åŠ¨åº”ç”¨æ—¶
    â†“
è‡ªåŠ¨æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬
    â†“
å¼¹å‡ºæ›´æ–°å¯¹è¯æ¡†
```

---

## ğŸ›¡ï¸ å®‰å…¨æç¤º

### å¦‚æœæ–°ç‰ˆæœ¬æœ‰ bug æ€ä¹ˆåŠï¼Ÿ

**ç«‹å³å›æ»šï¼š**

```sql
-- ç¦ç”¨æœ‰é—®é¢˜çš„ç‰ˆæœ¬
UPDATE app_versions 
SET is_active = false 
WHERE version = '1.0.1';

-- æˆ–è€…é™ä½æœ€ä½ç‰ˆæœ¬è¦æ±‚
UPDATE app_versions 
SET min_version = '1.0.0'  -- å…è®¸ 1.0.0 ç»§ç»­ä½¿ç”¨
WHERE version = '1.0.1';
```

**ç”¨æˆ·ä¸‹æ¬¡å¯åŠ¨ï¼š**
- ä¸å†æ£€æµ‹åˆ° 1.0.1
- å¯ä»¥ç»§ç»­ä½¿ç”¨ 1.0.0

---

## ğŸ‰ æ€»ç»“

**ä½ çš„æ›´æ–°æµç¨‹ï¼š**
1. âœ… ä½ å‘å¸ƒæ–°ç‰ˆæœ¬ â†’ ä¸Šä¼ åˆ° Supabase
2. âœ… è®¾ç½® `min_version = å½“å‰ç‰ˆæœ¬å·`
3. âœ… ç”¨æˆ·ä¸‹æ¬¡å¯åŠ¨ â†’ ç«‹å³æ£€æµ‹åˆ°
4. âœ… è€ç‰ˆæœ¬å¤±æ•ˆ â†’ å¿…é¡»æ›´æ–°
5. âœ… æ‰€æœ‰ç”¨æˆ·ä¿æŒåœ¨æœ€æ–°ç‰ˆæœ¬

**å®Œç¾ç¬¦åˆä½ çš„éœ€æ±‚ï¼** ğŸ¯

---

**ç°åœ¨éœ€è¦æˆ‘å¸®ä½ é…ç½® Supabase å—ï¼Ÿ**