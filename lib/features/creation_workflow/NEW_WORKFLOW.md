# 新创作流程说明

## 🎯 核心概念

### 创作流程重新设计
从"直接创建作品"改为"**选择→输入/生成→确认→作品空间**"的完整流程。

---

## 📋 完整流程图

```
创作空间
    ↓
点击"创建作品"
    ↓
【选择界面】━━━━━━━━━━━┓
    ↓                  ↓
故事输入              剧本输入
    ↓                  ↓
【故事→剧本生成】      【直接输入剧本】
    ↓                  ↓
生成剧本              确认剧本
    ↓                  ↓
输入作品名称 ←━━━━━━━━┛
    ↓
创建作品（生成ID）
    ↓
【作品空间】
    ├─ 剧本空间（可编辑）
    ├─ 角色管理
    ├─ 场景管理
    ├─ 物品管理
    └─ 下一步...
```

---

## 🔵 第1步：选择创作方式

### 界面描述
- **位置**：全屏居中
- **布局**：两个大按钮左右排列
- **按钮1**：故事输入
  - 图标：📖 (auto_stories)
  - 标题：故事输入
  - 描述：输入故事，AI生成剧本
  - 颜色：紫色渐变
- **按钮2**：剧本输入
  - 图标：📄 (description)
  - 标题：剧本输入
  - 描述：直接输入剧本内容
  - 颜色：粉色渐变

### 交互
- 点击任意按钮进入对应的输入界面

---

## 🟢 第2步：故事输入（路径A）

### 界面布局
```
┌──────────────────────────────────────────────┐
│  ← 故事输入                                   │
├──────────────────────────────────────────────┤
│                                              │
│  ┌────────────────┐  ┌────────────────────┐ │
│  │                │  │  [提示词] [生成剧本] [下一步] │
│  │  故事内容      │  │                    │ │
│  │  (左边文本框)  │  │  生成的剧本        │ │
│  │                │  │  (右边文本框)      │ │
│  │                │  │                    │ │
│  └────────────────┘  └────────────────────┘ │
│                                              │
└──────────────────────────────────────────────┘
```

### 组件说明

#### 左边：故事输入框
- **标题**：故事内容
- **功能**：粘贴或输入故事
- **提示**："在此粘贴或输入您的故事..."

#### 右边：剧本生成区
- **标题**：生成的剧本
- **按钮组**（右上角）：
  1. **提示词按钮**（小）：
     - 样式：OutlinedButton
     - 图标：⚙️ (settings)
     - 标签：显示当前选择的预设名称（如"默认"）
     - 功能：打开提示词预设管理器
  
  2. **生成剧本按钮**（大）：
     - 样式：ElevatedButton
     - 图标：✨ (auto_awesome)
     - 标签："生成剧本" / "生成中..."
     - 功能：调用LLM生成剧本
  
  3. **下一步按钮**：
     - 样式：ElevatedButton
     - 图标：→ (arrow_forward)
     - 标签："下一步"
     - 状态：剧本为空时禁用
     - 功能：进入作品空间

### 提示词预设管理器

#### 界面布局
```
┌──────────────────────────────────────┐
│  提示词预设管理            [新建] [×] │
├──────────────────────────────────────┤
│  ┌─────────┐  ┌─────────────────────┐│
│  │ 预设列表 │  │ 名称: [        ]    ││
│  │         │  │                     ││
│  │ 默认    │  │ 提示词内容:         ││
│  │ 简洁版  │  │ ┌─────────────────┐ ││
│  │ 详细版  │  │ │                 │ ││
│  │         │  │ │                 │ ││
│  │         │  │ └─────────────────┘ ││
│  └─────────┘  │              [删除] ││
│                └─────────────────────┘│
│                         [取消] [确定] │
└──────────────────────────────────────┘
```

#### 功能说明
- **新建**：添加新预设
- **删除**：删除当前选择的预设（至少保留1个）
- **左侧列表**：显示所有预设名称
- **右侧编辑**：
  - 名称输入框
  - 内容多行文本框
  - 实时保存（onChanged）
- **确定**：返回选择的预设

#### 默认预设
1. **默认**：
   ```
   请根据以下故事内容，生成一个详细的剧本。要求：
   1. 保留故事的核心情节
   2. 添加场景描述
   3. 包含角色对白
   4. 标注场景切换
   ```

2. **简洁版**：
   ```
   请将以下故事转换为简洁的剧本格式，突出关键情节和对话。
   ```

3. **详细版**：
   ```
   请根据以下故事，创作一个详细的剧本。要求：
   1. 详细的场景描述（光线、氛围、环境）
   2. 人物动作和表情
   3. 丰富的对白
   4. 镜头提示
   5. 音效和背景音乐建议
   ```

---

## 🔵 第3步：剧本输入（路径B）

### 界面布局
```
┌──────────────────────────────────────────────┐
│  ← 剧本输入                        [下一步] → │
├──────────────────────────────────────────────┤
│                                              │
│  ┌──────────────────────────────────────┐   │
│  │                                      │   │
│  │  剧本内容                            │   │
│  │  (大文本框)                          │   │
│  │                                      │   │
│  │                                      │   │
│  │                                      │   │
│  └──────────────────────────────────────┘   │
│                                              │
└──────────────────────────────────────────────┘
```

### 组件说明
- **标题**：剧本内容
- **文本框**：
  - 多行输入
  - 提示："在此粘贴或输入您的剧本..."
- **下一步按钮**（右上角）：
  - 剧本不为空时启用
  - 点击进入作品空间

---

## 🟣 第4步：作品命名

### 触发时机
- 故事输入点击"下一步"后
- 剧本输入点击"下一步"后

### 界面
```
┌──────────────────────┐
│  作品命名            │
├──────────────────────┤
│  ┌────────────────┐  │
│  │ 输入作品名称   │  │
│  └────────────────┘  │
│              [确定]  │
└──────────────────────┘
```

### 功能
- 自动聚焦输入框
- 按回车键 = 点击确定
- 点击确定后：
  1. 生成作品ID（时间戳）
  2. 保存作品数据
  3. 添加到作品列表
  4. 进入作品空间

---

## 🟡 第5步：作品空间

### 界面布局
```
┌──────────────────────────────────────────────┐
│  ← 作品名称                                   │
│    来源：故事输入 / 剧本输入                  │
├──────────────────────────────────────────────┤
│                                              │
│  ┌──────────────────────────────────────┐   │
│  │  剧本空间    [角色] [场景] [物品] [下一步] │
│  ├──────────────────────────────────────┤   │
│  │                                      │   │
│  │  剧本内容（可编辑）                  │   │
│  │                                      │   │
│  │                                      │   │
│  │  • 自动保存                          │   │
│  │                                      │   │
│  └──────────────────────────────────────┘   │
│                                              │
└──────────────────────────────────────────────┘
```

### 组件说明

#### 顶部工具栏
- **标题**：剧本空间
- **按钮组**（右侧）：
  1. **角色按钮**
     - 图标：👤 (person)
     - 功能：打开角色管理（待实现）
  
  2. **场景按钮**
     - 图标：🏞️ (landscape)
     - 功能：打开场景管理（待实现）
  
  3. **物品按钮**
     - 图标：📦 (category)
     - 功能：打开物品管理（待实现）
  
  4. **下一步按钮**
     - 图标：→ (arrow_forward)
     - 功能：进入下一阶段（待实现）

#### 剧本编辑区
- **多行文本框**
- **实时自动保存**（onChanged）
- **保存位置**：`work_{workId}`

---

## 💾 数据存储

### 作品数据结构
```dart
{
  "id": "1738070400000",
  "name": "我的第一部作品",
  "script": "第一幕：...",
  "sourceType": "故事输入",  // 或 "剧本输入"
  "updatedAt": "2026-01-28T10:00:00.000Z"
}
```

### 存储位置
- **作品数据**：`work_{workId}`（单个作品的完整数据）
- **作品列表**：`creation_works`（所有作品的列表）
- **提示词预设**：`prompt_presets`（提示词管理）

### 自动保存机制
- **作品空间**：每次编辑（onChanged）触发保存
- **提示词**：每次修改立即保存
- **作品列表**：新建作品时更新

---

## 🎨 UI设计规范

### 颜色方案
- **背景**：#161618（深邃黑）
- **卡片**：#1E1E20（次级黑）
- **边框**：#2A2A2C
- **文字主色**：#FFFFFF
- **文字次色**：#888888
- **按钮背景**：#3A3A3C
- **按钮文字**：#888888
- **选择按钮渐变**：
  - 故事输入：紫色（#667eea → #764ba2）
  - 剧本输入：粉色（#f093fb → #F5576C）

### 按钮样式
- **大按钮**：ElevatedButton
  - 背景：#3A3A3C
  - 文字：#888888
  - 圆角：8px
  
- **小按钮**：OutlinedButton
  - 边框：#3A3A3C
  - 文字：#888888

---

## 🔄 流程对比

### 旧流程
```
点击"创建作品" → 输入名称 → 创建卡片 → 点击卡片 → 进入工作流
```

### 新流程
```
点击"创建作品" 
  → 选择方式（故事/剧本）
    → 输入/生成内容
      → 确认并命名
        → 创建作品
          → 进入作品空间
            → 编辑剧本
              → 管理角色/场景/物品
                → 继续后续步骤...
```

---

## ✅ 已实现功能

- ✅ 选择界面（故事输入 vs 剧本输入）
- ✅ 故事输入页面
- ✅ 剧本输入页面
- ✅ 提示词预设管理器
- ✅ 作品空间（剧本编辑）
- ✅ 自动保存机制
- ✅ 作品列表集成

---

## 🚧 待实现功能

### 作品空间后续部分
- ⏳ 角色管理
- ⏳ 场景管理
- ⏳ 物品管理
- ⏳ 下一步功能

### AI集成
- ⏳ 接入真实LLM API（故事→剧本生成）
- ⏳ 提示词模板优化
- ⏳ 生成进度提示

---

## 📝 使用说明

### 创建新作品

#### 方式1：故事输入
1. 点击"创建作品"
2. 选择"故事输入"
3. 粘贴故事到左边文本框
4. 点击"提示词"按钮选择预设（可选）
5. 点击"生成剧本"
6. 等待AI生成（2秒Mock）
7. 查看右边生成的剧本
8. 点击"下一步"
9. 输入作品名称
10. 进入作品空间

#### 方式2：剧本输入
1. 点击"创建作品"
2. 选择"剧本输入"
3. 粘贴剧本到文本框
4. 点击"下一步"
5. 输入作品名称
6. 进入作品空间

### 编辑已有作品
1. 在创作空间点击作品卡片
2. 自动加载之前的剧本内容
3. 编辑剧本（自动保存）
4. 使用右上角按钮管理角色/场景/物品
5. 点击返回保存并退出

---

## 🎯 关键特性

### 1. 独立作品空间
- 每个作品有独立的ID
- 数据独立存储
- 互不影响

### 2. 自动保存
- 无需手动保存
- 实时保存所有修改
- 数据持久化

### 3. 灵活创作
- 支持故事→剧本（AI辅助）
- 支持直接输入剧本
- 可编辑和修改

### 4. 提示词管理
- 预设提示词
- 自定义提示词
- 随时新建/修改/删除

---

**版本**: v2.0.0  
**更新日期**: 2026-01-28  
**状态**: ✅ 核心功能已完成 | 🚧 角色/场景/物品待实现
