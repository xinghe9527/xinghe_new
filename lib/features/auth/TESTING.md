# 会员系统测试指南

## 测试前准备

### 1. 确保后端 API 可访问
```bash
# 测试 API 连接
curl https://api.xhaigc.cn/users
```

### 2. 准备测试数据

在后端 `invitation_codes` 集合中创建测试邀请码：
```json
{
  "code": "TEST2024",
  "duration_days": 30,
  "is_used": false
}
```

## 测试流程

### 测试 1: 未登录状态
1. 启动应用
2. 查看左侧边栏顶部
3. **预期结果**：
   - 显示默认头像（logo.png）
   - 显示"点击登录"文字
   - 显示"同步创意"副标题
   - 有右箭头图标

### 测试 2: 打开登录对话框
1. 点击侧边栏顶部的用户头像区域
2. **预期结果**：
   - 弹出登录/注册对话框
   - 默认显示"登录"标签页
   - 有"登录"和"注册"两个切换按钮

### 测试 3: 注册新用户
1. 切换到"注册"标签
2. 填写信息：
   - 用户名: `测试用户`
   - 邮箱: `test@example.com`
   - 密码: `123456`
   - 邀请码: `TEST2024`
3. 点击"注册"按钮
4. **预期结果**：
   - 显示"注册成功"提示
   - 对话框自动关闭
   - 侧边栏显示用户名"测试用户"
   - 显示会员过期时间（30天后）

### 测试 4: 邀请码验证
1. 尝试使用已使用的邀请码注册
2. **预期结果**：
   - 显示"邀请码无效或已被使用"错误

### 测试 5: 邮箱唯一性
1. 尝试使用已注册的邮箱再次注册
2. **预期结果**：
   - 显示"该邮箱已被注册"错误

### 测试 6: 登出后登录
1. 重启应用（模拟登出）
2. 点击"点击登录"
3. 切换到"登录"标签
4. 填写：
   - 邮箱: `test@example.com`
   - 密码: `123456`
   - 勾选"记住我"
5. 点击"登录"
6. **预期结果**：
   - 显示"登录成功"提示
   - 侧边栏恢复用户信息

### 测试 7: 自动登录
1. 勾选"记住我"后登录
2. 完全关闭应用
3. 重新启动应用
4. **预期结果**：
   - 应用启动后自动显示已登录状态
   - 无需重新输入账号密码

### 测试 8: 更新头像
1. 确保已登录
2. 点击侧边栏的用户头像
3. 选择一张图片
4. **预期结果**：
   - 显示"头像更新成功"提示
   - 头像立即更新显示
   - 注意：当前版本需要集成 OSS 上传

### 测试 9: 会员过期检查
1. 在后端修改用户的 `expire_date` 为过去的时间
2. 尝试登录
3. **预期结果**：
   - 显示"会员已过期，请联系管理员续费"错误
   - 无法登录

### 测试 10: 会员过期显示
1. 登录后，在后端修改 `expire_date` 为过去时间
2. 刷新用户信息或重启应用
3. **预期结果**：
   - 副标题显示"已过期"
   - 文字颜色变为红色

## 常见问题排查

### 问题 1: 无法连接到 API
- 检查网络连接
- 确认 API 地址正确：`https://api.xhaigc.cn`
- 查看控制台错误日志

### 问题 2: 邀请码验证失败
- 确认后端有可用的邀请码
- 检查邀请码的 `is_used` 字段为 `false`
- 查看 API 响应日志

### 问题 3: 自动登录失败
- 检查 SharedPreferences 是否正确保存
- 确认 Token 格式正确
- 验证用户未过期

### 问题 4: 头像上传失败
- 当前版本需要集成 OSS 服务
- 检查 image_picker 权限配置
- 查看上传服务日志

## 调试技巧

### 1. 查看保存的认证状态
```dart
final prefs = await SharedPreferences.getInstance();
final authStateJson = prefs.getString('auth_state');
print('保存的认证状态: $authStateJson');
```

### 2. 查看保存的凭据
```dart
final prefs = await SharedPreferences.getInstance();
print('记住我: ${prefs.getBool('remember_me')}');
print('邮箱: ${prefs.getString('saved_email')}');
```

### 3. 清除所有保存的数据
```dart
final prefs = await SharedPreferences.getInstance();
await prefs.clear();
```

## 性能测试

1. **启动速度**：应用启动到显示登录状态应在 1 秒内
2. **登录响应**：点击登录到完成应在 2 秒内
3. **注册响应**：点击注册到完成应在 3 秒内（包含邀请码验证）

## 安全测试

1. **密码显示**：确认密码输入框默认隐藏
2. **Token 存储**：确认 Token 安全存储在本地
3. **会员验证**：确认过期会员无法登录
4. **邀请码核销**：确认邀请码只能使用一次
